### Test Error Responses for Microservices
### Author: Error Handling Testing
### Description: Test various error scenarios to verify error responses

### Variables
@gateway = http://localhost:8080
@token = eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0ZWFjaGVyQGV4YW1wbGUuY29tIiwiZW1haWwiOiJ0ZWFjaGVyQGV4YW1wbGUuY29tIiwicm9sZSI6IlRFQUNIRVIiLCJ1c2VySWQiOiJ0ZWFjaGVyLWlkLTEyMyIsImZpcnN0bmFtZSI6IkpvaG4iLCJsYXN0bmFtZSI6IkRvZSIsImV4cCI6MTc5OTk5OTk5OX0.placeholder

### ==================== ACADEMIC SERVICE ERROR TESTS ====================

### 1. Test COURSE_NOTFOUND error
# @name getCourseNotFound
GET {{gateway}}/api/v1/course/non-existent-course-id
Authorization: Bearer {{token}}

### Expected Response:
# {
#   "code": "COURSE_NOT_FOUND",
#   "message": "Course not found with id: non-existent-course-id"
# }

###

### 2. Test INVALID_MEMBER error (try to access course you're not member of)
# @name invalidMember
GET {{gateway}}/api/v1/course/some-course-id-you-dont-own
Authorization: Bearer {{token}}

### Expected Response:
# {
#   "code": "INVALID_MEMBER",
#   "message": "You are not a member of course: some-course-id"
# }

###

### 3. Test COURSE_ALREADY_EXISTS error
# @name createDuplicateCourse
POST {{gateway}}/api/v1/course/create
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Test Course",
  "description": "This is a test course"
}

### Then try to create with same name again to trigger duplicate error

###

### 4. Test Validation Error - Empty course name
# @name validationErrorEmptyName
POST {{gateway}}/api/v1/course/create
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "",
  "description": "This should fail validation"
}

### Expected Response:
# {
#   "validationErrorList": [
#     {
#       "field": "name",
#       "code": "VALIDATION.COURSE.NAME.NOT_BLANK",
#       "message": "VALIDATION.COURSE.NAME.NOT_BLANK"
#     }
#   ]
# }

###

### ==================== GRADING SERVICE ERROR TESTS ====================

### 5. Test ASSIGNMENT_NOTFOUND error
# @name getAssignmentNotFound
GET {{gateway}}/api/v1/grading/assignments/non-existent-assignment-id
Authorization: Bearer {{token}}

### Expected Response:
# {
#   "code": "ASSIGNMENT_NOT_FOUND",
#   "message": "Assignment not found with id: non-existent-assignment-id"
# }

###

### 6. Test LECTURE_NOTFOUND error
# @name getLectureNotFound
GET {{gateway}}/api/v1/grading/lectures/non-existent-lecture-id
Authorization: Bearer {{token}}

### Expected Response:
# {
#   "code": "LECTURE_NOT_FOUND",
#   "message": "Lecture not found with id: non-existent-lecture-id"
# }

###

### 7. Test SUBMISSION_NOTFOUND error
# @name getSubmissionNotFound
GET {{gateway}}/api/v1/grading/submissions/non-existent-submission-id
Authorization: Bearer {{token}}

### Expected Response:
# {
#   "code": "SUBMISSION_NOT_FOUND",
#   "message": "Submission not found with id: non-existent-submission-id"
# }

###

### 8. Test Assignment Validation Error - Empty title
# @name assignmentValidationError
POST {{gateway}}/api/v1/grading/assignments/create
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "",
  "description": "Test assignment",
  "courseId": "course-123",
  "createBy": "teacher-id",
  "submissionDate": "2026-12-31 23:59:59"
}

### Expected Response:
# {
#   "validationErrorList": [
#     {
#       "field": "title",
#       "code": "VALIDATION.ASSIGNMENT.TITLE.NOT_BLANK",
#       "message": "VALIDATION.ASSIGNMENT.TITLE.NOT_BLANK"
#     }
#   ]
# }

###

### 9. Test Lecture Validation Error - Missing courseId
# @name lectureValidationError
POST {{gateway}}/api/v1/grading/lectures/upload
Authorization: Bearer {{token}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary

------WebKitFormBoundary
Content-Disposition: form-data; name="title"

Test Lecture
------WebKitFormBoundary
Content-Disposition: form-data; name="description"

Test description
------WebKitFormBoundary
Content-Disposition: form-data; name="courseId"


------WebKitFormBoundary
Content-Disposition: form-data; name="file"; filename="test.pdf"
Content-Type: application/pdf

fake pdf content
------WebKitFormBoundary--

### Expected Response:
# {
#   "validationErrorList": [
#     {
#       "field": "courseId",
#       "code": "VALIDATION.LECTURE.COURSE_ID.NOT_BLANK",
#       "message": "VALIDATION.LECTURE.COURSE_ID.NOT_BLANK"
#     }
#   ]
# }

###

### 10. Test FILE_TOO_LARGE error (file > 10MB)
# @name fileTooLargeError
POST {{gateway}}/api/v1/grading/lectures/upload
Authorization: Bearer {{token}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary

------WebKitFormBoundary
Content-Disposition: form-data; name="title"

Large File Test
------WebKitFormBoundary
Content-Disposition: form-data; name="courseId"

course-123
------WebKitFormBoundary
Content-Disposition: form-data; name="file"; filename="large-file.pdf"
Content-Type: application/pdf

# NOTE: This would need a real 10MB+ file to test properly
# For manual testing, use a file larger than 10MB
------WebKitFormBoundary--

### Expected Response:
# {
#   "code": "FILE_TOO_LARGE",
#   "message": "File size exceeds maximum limit of 10MB"
# }

###

### 11. Test INVALID_FILE_TYPE error
# @name invalidFileTypeError
POST {{gateway}}/api/v1/grading/lectures/upload
Authorization: Bearer {{token}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary

------WebKitFormBoundary
Content-Disposition: form-data; name="title"

Invalid File Test
------WebKitFormBoundary
Content-Disposition: form-data; name="courseId"

course-123
------WebKitFormBoundary
Content-Disposition: form-data; name="file"; filename="test.exe"
Content-Type: application/x-msdownload

fake exe content
------WebKitFormBoundary--

### Expected Response:
# {
#   "code": "INVALID_FILE_TYPE",
#   "message": "Invalid file type. Only PDF, PPT, DOCX, Excel, ZIP, RAR files are allowed"
# }

###

### 12. Test INTERNAL_EXCEPTION error (generic error)
# This is hard to trigger intentionally, but it should return:
# {
#   "code": "INTERNAL_EXCEPTION",
#   "message": "Internal server error"
# }

###

### ==================== AUTHENTICATION ERROR TESTS ====================

### 13. Test Unauthorized access (no token)
# @name unauthorizedAccess
GET {{gateway}}/api/v1/grading/assignments/list

### Expected: 401 Unauthorized

###

### 14. Test Forbidden access (student trying to create assignment)
# @name forbiddenAccess
# Use student token instead of teacher token
POST {{gateway}}/api/v1/grading/assignments/create
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Test Assignment",
  "description": "This should fail due to insufficient permissions",
  "courseId": "course-123",
  "createBy": "student-id",
  "submissionDate": "2026-12-31 23:59:59"
}

### Expected: 403 Forbidden

###

### ==================== SUMMARY ====================
### Error Codes Tested:
### Academic Service:
### - COURSE_NOTFOUND (404)
### - COURSE_ALREADY_EXISTS (400)
### - INVALID_MEMBER (403)
### - INTERNAL_EXCEPTION (500)
### - Validation errors (400)
###
### Grading Service:
### - ASSIGNMENT_NOTFOUND (404)
### - LECTURE_NOTFOUND (404)
### - SUBMISSION_NOTFOUND (404)
### - ASSIGNMENT_ALREADY_EXISTS (400)
### - LECTURE_ALREADY_EXISTS (400)
### - SUBMISSION_ALREADY_EXISTS (400)
### - SUBMISSION_DEADLINE_PASSED (400)
### - FILE_TOO_LARGE (400)
### - INVALID_FILE_TYPE (400)
### - FILE_STORAGE_EXCEPTION (500)
### - FILE_NOT_FOUND (404)
### - INTERNAL_EXCEPTION (500)
### - Validation errors (400)
