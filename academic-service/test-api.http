### ============================================
### Academic Service API Testing
### ============================================
### Prerequisites:
### 1. Start Discovery Server (port 8761)
### 2. Start Identity Service (port 8081)
### 3. Start API Gateway (port 8080)
### 4. Start Academic Service (port 8082)
### 5. Get JWT token from Identity Service first
### ============================================

### Variables
@baseUrl = http://localhost:8080
@identityUrl = {{baseUrl}}/api/v1/identity
@academicUrl = {{baseUrl}}/api/v1/academic

# Thay token n√†y sau khi login
@token = your-jwt-token-here

### ============================================
### 1. IDENTITY SERVICE - Login to get JWT Token
### ============================================

### Login as Teacher
POST {{identityUrl}}/auth/login
Content-Type: application/json

{
  "email": "teacher@school.com",
  "password": "password123"
}

### Response will contain:
# {
#   "accessToken": "eyJhbGciOiJSUzI1NiJ9...",
#   "refreshToken": "...",
#   "expiresIn": 900
# }
### Copy the accessToken and paste it in @token variable above

### ============================================
### 2. ACADEMIC SERVICE - Course Management
### ============================================

### Get All Courses (Authenticated users)
GET {{academicUrl}}/courses/all
Authorization: Bearer {{token}}

###

### Get Course by ID (Authenticated users)
GET {{academicUrl}}/courses/COURSE-001
Authorization: Bearer {{token}}

###

### Create New Course (TEACHER role only)
POST {{academicUrl}}/courses/create
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "courseName": "Microservices Architecture",
  "courseCode": "CS401",
  "description": "Learn how to build scalable microservices",
  "credits": 3
}

### Expected Response (Success):
# HTTP/1.1 201 Created
# "Course created successfully by John Doe"

### Expected Response (Forbidden - if not TEACHER):
# HTTP/1.1 403 Forbidden
# {
#   "error": "Access Denied"
# }

###

### Get My Created Courses
GET {{academicUrl}}/courses/my-courses
Authorization: Bearer {{token}}

### Expected Response:
# {
#   "message": "Getting courses for user: teacher@school.com (ID: 123)"
# }

###

### Delete Course (TEACHER role only)
DELETE {{academicUrl}}/courses/COURSE-001
Authorization: Bearer {{token}}

### Expected Response (Success):
# HTTP/1.1 204 No Content

### Expected Response (Forbidden - if not TEACHER):
# HTTP/1.1 403 Forbidden

### ============================================
### 3. ERROR SCENARIOS - Testing Security
### ============================================

### Test without token (Should return 401)
GET {{academicUrl}}/courses/all

### Expected Response:
# HTTP/1.1 401 Unauthorized

###

### Test with invalid token (Should return 401)
GET {{academicUrl}}/courses/all
Authorization: Bearer invalid-token-here

### Expected Response:
# HTTP/1.1 401 Unauthorized

###

### Test with expired token (Should return 401)
GET {{academicUrl}}/courses/all
Authorization: Bearer eyJhbGciOiJSUzI1NiJ9.expired.token

### Expected Response:
# HTTP/1.1 401 Unauthorized

###

### Test TEACHER-only endpoint as STUDENT (Should return 403)
# First login as student to get student token
POST {{identityUrl}}/auth/login
Content-Type: application/json

{
  "email": "student@school.com",
  "password": "password123"
}

### Then use student token to try creating course
POST {{academicUrl}}/courses/create
Content-Type: application/json
Authorization: Bearer student-token-here

{
  "courseName": "Unauthorized Course",
  "courseCode": "CS999"
}

### Expected Response:
# HTTP/1.1 403 Forbidden
# {
#   "error": "Access Denied",
#   "message": "User does not have required role: TEACHER"
# }

### ============================================
### 4. DEBUGGING - Check Headers Forwarded
### ============================================

### You can add this endpoint in CourseController for debugging:
### GET /api/v1/academic/courses/debug-headers

### Example Debug Response:
# {
#   "X-User-Id": "123",
#   "X-User-Email": "teacher@school.com",
#   "X-Roles": "TEACHER",
#   "X-Firstname": "John",
#   "X-Lastname": "Doe"
# }
